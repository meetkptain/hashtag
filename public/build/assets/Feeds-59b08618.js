import{o as d,k as h,g as w,h as b,c,a as e,w as k,s as A,q as x,T as D,x as S,r as g,n as B,j as G,m as N,F as P,t as r,b as m,v as f,l as U,p as E}from"./app-18070004.js";import{_ as R}from"./Layout-245e44e2.js";const q=(p,u)=>{const l=p.__vccOpts||p;for(const[n,a]of u)l[n]=a;return l},z={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},H={__name:"Modal",props:{show:Boolean},emits:["close"],setup(p,{emit:u}){const l=u,n=()=>{l("close")};return(a,i)=>(d(),h(S,{to:"body"},[w(D,{name:"modal"},{default:b(()=>[p.show?(d(),c("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:n},[e("div",z,[i[1]||(i[1]=e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75","aria-hidden":"true"},null,-1)),i[2]||(i[2]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",{onClick:i[0]||(i[0]=k(()=>{},["stop"])),class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},[A(a.$slots,"default",{},void 0,!0)])])])):x("",!0)]),_:3})]))}},J=q(H,[["__scopeId","data-v-bfad8e7b"]]),L={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},X={class:"flex items-start justify-between mb-4"},O={class:"flex items-center gap-3"},K={class:"text-3xl"},Q={class:"font-semibold text-gray-900"},W={class:"text-sm text-gray-500"},Y={class:"space-y-2 mb-4"},Z={class:"flex items-center justify-between text-sm"},ee={class:"font-medium"},te={class:"flex items-center justify-between text-sm"},se={class:"font-medium"},oe={class:"flex items-center justify-between text-sm"},ae={class:"font-medium"},le={class:"flex gap-2"},ne=["onClick"],ie=["onClick"],re=["onClick"],de={class:"p-6"},ue={class:"text-2xl font-bold mb-6"},ce={key:0},pe={key:1},me={key:2},ve={class:"flex gap-3 pt-4"},ge={type:"submit",class:"btn btn-primary flex-1"},xe={__name:"Feeds",setup(p){const u=g([]),l=g(!1),n=g(null),a=g({name:"",type:"instagram",config:{hashtags:[],page_id:"",place_id:""}}),i=B({get:()=>{var s;return((s=a.value.config.hashtags)==null?void 0:s.join(`
`))||""},set:s=>{a.value.config.hashtags=s.split(`
`).map(t=>t.trim()).filter(t=>t)}});G(()=>{v()});const v=async()=>{try{const s=await axios.get("/api/feeds");u.value=s.data.feeds}catch(s){console.error("Failed to load feeds",s)}},F=async()=>{try{n.value?await axios.put(`/api/feeds/${n.value.id}`,a.value):await axios.post("/api/feeds",a.value),l.value=!1,n.value=null,M(),v()}catch(s){alert("Erreur lors de la sauvegarde du flux"),console.error(s)}},C=s=>{n.value=s,a.value={name:s.name,type:s.type,config:{...s.config}},l.value=!0},$=async s=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce flux ?"))try{await axios.delete(`/api/feeds/${s.id}`),v()}catch{alert("Erreur lors de la suppression du flux")}},j=async s=>{try{await axios.post(`/api/feeds/${s.id}/sync`),alert("Synchronisation lancée !"),setTimeout(v,2e3)}catch{alert("Erreur lors de la synchronisation")}},M=()=>{a.value={name:"",type:"instagram",config:{hashtags:[],page_id:"",place_id:""}}},T=s=>({instagram:"📷",facebook:"👍",twitter:"🐦",google_reviews:"⭐"})[s]||"📱",I=s=>({instagram:"Instagram",facebook:"Facebook",twitter:"Twitter / X",google_reviews:"Google Reviews"})[s]||s,V=s=>s?new Date(s).toLocaleString("fr-FR"):"Jamais";return(s,t)=>(d(),h(R,{title:"Gestion des Flux"},{"header-actions":b(()=>[e("button",{onClick:t[0]||(t[0]=o=>l.value=!0),class:"btn btn-primary"}," ➕ Ajouter un flux ")]),default:b(()=>[e("div",L,[(d(!0),c(P,null,N(u.value,o=>{var y;return d(),c("div",{key:o.id,class:"card hover:shadow-lg transition-shadow"},[e("div",X,[e("div",O,[e("span",K,r(T(o.type)),1),e("div",null,[e("h3",Q,r(o.name),1),e("p",W,r(I(o.type)),1)])]),e("span",{class:E([o.active?"badge-success":"badge-danger","badge"])},r(o.active?"Actif":"Inactif"),3)]),e("div",Y,[e("div",Z,[t[9]||(t[9]=e("span",{class:"text-gray-600"},"Posts",-1)),e("span",ee,r(o.posts_count),1)]),e("div",te,[t[10]||(t[10]=e("span",{class:"text-gray-600"},"Hashtags",-1)),e("span",se,r(((y=o.config.hashtags)==null?void 0:y.length)||0),1)]),e("div",oe,[t[11]||(t[11]=e("span",{class:"text-gray-600"},"Dernière synchro",-1)),e("span",ae,r(V(o.last_fetched_at)),1)])]),e("div",le,[e("button",{onClick:_=>j(o),class:"btn btn-secondary flex-1 text-sm"}," 🔄 Synchroniser ",8,ne),e("button",{onClick:_=>C(o),class:"btn btn-secondary flex-1 text-sm"}," ✏️ Modifier ",8,ie),e("button",{onClick:_=>$(o),class:"btn btn-danger text-sm"}," 🗑️ ",8,re)])])}),128)),e("button",{onClick:t[1]||(t[1]=o=>l.value=!0),class:"card border-2 border-dashed border-gray-300 hover:border-primary-500 hover:bg-primary-50 flex items-center justify-center min-h-[250px] transition-colors"},[...t[12]||(t[12]=[e("div",{class:"text-center"},[e("span",{class:"text-5xl mb-3 block"},"➕"),e("p",{class:"font-medium text-gray-900"},"Ajouter un flux"),e("p",{class:"text-sm text-gray-500 mt-1"},"Instagram, Facebook, Twitter, Google Reviews")],-1)])])]),w(J,{show:l.value,onClose:t[8]||(t[8]=o=>l.value=!1)},{default:b(()=>[e("div",de,[e("h2",ue,r(n.value?"Modifier le flux":"Ajouter un flux"),1),e("form",{onSubmit:k(F,["prevent"]),class:"space-y-4"},[e("div",null,[t[13]||(t[13]=e("label",{class:"label"},"Nom du flux",-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.name=o),type:"text",class:"input",placeholder:"Mon flux Instagram",required:""},null,512),[[f,a.value.name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"label"},"Type de plateforme",-1)),m(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.type=o),class:"input",required:""},[...t[14]||(t[14]=[e("option",{value:"instagram"},"Instagram",-1),e("option",{value:"facebook"},"Facebook",-1),e("option",{value:"twitter"},"Twitter / X",-1),e("option",{value:"google_reviews"},"Google Reviews",-1)])],512),[[U,a.value.type]])]),a.value.type!=="google_reviews"?(d(),c("div",ce,[t[16]||(t[16]=e("label",{class:"label"},"Hashtags (un par ligne)",-1)),m(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=o=>i.value=o),class:"input",rows:"4",placeholder:`#hashtag1
#hashtag2`},null,512),[[f,i.value]])])):x("",!0),a.value.type==="facebook"?(d(),c("div",pe,[t[17]||(t[17]=e("label",{class:"label"},"Page ID Facebook",-1)),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.config.page_id=o),type:"text",class:"input",placeholder:"123456789"},null,512),[[f,a.value.config.page_id]])])):x("",!0),a.value.type==="google_reviews"?(d(),c("div",me,[t[18]||(t[18]=e("label",{class:"label"},"Place ID Google",-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.config.place_id=o),type:"text",class:"input",placeholder:"ChIJ..."},null,512),[[f,a.value.config.place_id]])])):x("",!0),e("div",ve,[e("button",{type:"button",onClick:t[7]||(t[7]=o=>l.value=!1),class:"btn btn-secondary flex-1"}," Annuler "),e("button",ge,r(n.value?"Mettre à jour":"Ajouter"),1)])],32)])]),_:1},8,["show"])]),_:1}))}};export{xe as default};
